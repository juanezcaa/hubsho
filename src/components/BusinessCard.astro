---
// BusinessCard-Animated.astro - Versi√≥n con animaciones premium
// Incluye: Skeleton loading, shimmer effect, micro-interacciones

interface Props {
  nombre: string;
  puesto: string;
  empresa: string;
  foto?: string;
  usarIniciales?: boolean;
  logo?: string;
  telefono?: string;
  email?: string;
  sitioWeb?: string;
  linkedin?: string;
  twitter?: string;
  facebook?: string;
  instagram?: string;
  whatsapp?: string;
  colorPrimario?: string;
  colorSecundario?: string;
}

const {
  nombre,
  puesto,
  empresa,
  foto = "üë§",
  usarIniciales = false,
  logo,
  telefono,
  email,
  sitioWeb,
  linkedin,
  twitter,
  facebook,
  instagram,
  whatsapp,
  colorPrimario = "blue",
  colorSecundario = "gray"
} = Astro.props;

function getIniciales(nombre: string): string {
  return nombre
    .split(' ')
    .map(word => word[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);
}

const iniciales = getIniciales(nombre);

const vcardData = `BEGIN:VCARD
VERSION:3.0
FN:${nombre}
ORG:${empresa}
TITLE:${puesto}
TEL;TYPE=WORK,VOICE:${telefono || ''}
EMAIL:${email || ''}
URL:${sitioWeb || ''}
END:VCARD`;

const vcardDownloadUrl = `data:text/vcard;charset=utf-8,${encodeURIComponent(vcardData)}`;
const downloadFileName = `${nombre.replace(/\s+/g, '_')}.vcf`;
---

<!-- Skeleton Loading (se muestra por 800ms) -->
<div id="skeleton" class="skeleton-card bg-white p-6 md:p-8 w-full md:max-w-md md:mx-auto md:rounded-3xl md:shadow-2xl">
  <div class="flex justify-center mb-6">
    <div class="w-32 h-32 rounded-full bg-gray-200 skeleton-shimmer"></div>
  </div>
  <div class="text-center mb-6 space-y-3">
    <div class="h-8 bg-gray-200 rounded-lg w-48 mx-auto skeleton-shimmer"></div>
    <div class="h-6 bg-gray-200 rounded-lg w-36 mx-auto skeleton-shimmer"></div>
    <div class="h-5 bg-gray-200 rounded-lg w-28 mx-auto skeleton-shimmer"></div>
  </div>
  <div class="space-y-3 mb-6">
    <div class="h-5 bg-gray-200 rounded-lg w-full skeleton-shimmer"></div>
    <div class="h-5 bg-gray-200 rounded-lg w-full skeleton-shimmer"></div>
  </div>
  <div class="flex justify-center gap-3 mb-6">
    <div class="w-12 h-12 rounded-full bg-gray-200 skeleton-shimmer"></div>
    <div class="w-12 h-12 rounded-full bg-gray-200 skeleton-shimmer"></div>
  </div>
  <div class="h-12 bg-gray-200 rounded-xl skeleton-shimmer"></div>
</div>

<!-- Tarjeta Real (hidden inicialmente) -->
<div id="card" class={`hidden card-entrance bg-gradient-to-br from-${colorPrimario}-50 to-white p-6 md:p-8 w-full md:max-w-md md:mx-auto md:rounded-3xl md:shadow-2xl md:border-2 md:border-${colorPrimario}-100`}>
  
  <!-- Logo -->
  {logo && (
    <div class="flex justify-center mb-6 fade-in-item" style="animation-delay: 0.1s">
      <img src={logo} alt={empresa} class="h-12 hover-lift" />
    </div>
  )}
  
  <!-- Foto / Iniciales / Emoji -->
  <div class="flex justify-center mb-6 scale-in-item" style="animation-delay: 0.2s">
    {usarIniciales ? (
      <div class={`w-32 h-32 md:w-36 md:h-36 rounded-full bg-gradient-to-br from-${colorPrimario}-500 to-${colorPrimario}-700 flex items-center justify-center shadow-lg border-4 border-white hover-rotate`}>
        <span class="text-5xl font-bold text-white">{iniciales}</span>
      </div>
    ) : foto.startsWith('http') || foto.startsWith('/') ? (
      <img 
        src={foto} 
        alt={nombre}
        class={`w-32 h-32 md:w-36 md:h-36 rounded-full object-cover border-4 border-${colorPrimario}-500 shadow-lg hover-lift`}
      />
    ) : (
      <div class={`w-32 h-32 md:w-36 md:h-36 rounded-full bg-gradient-to-br from-${colorPrimario}-500 to-${colorPrimario}-700 flex items-center justify-center text-6xl shadow-lg border-4 border-white hover-bounce`}>
        {foto}
      </div>
    )}
  </div>

  <!-- Info -->
  <div class="text-center mb-6 fade-in-item" style="animation-delay: 0.3s">
    <h2 class={`text-2xl md:text-3xl font-bold text-${colorSecundario}-900 mb-2`}>
      {nombre}
    </h2>
    <p class={`text-lg md:text-xl font-semibold text-${colorPrimario}-600 mb-1`}>
      {puesto}
    </p>
    <p class={`text-base md:text-lg text-${colorSecundario}-600`}>
      {empresa}
    </p>
  </div>

  <!-- Contacto -->
  <div class="space-y-3 mb-6 fade-in-item" style="animation-delay: 0.4s">
    {telefono && (
      <a 
        href={`tel:${telefono}`}
        class={`flex items-center justify-center gap-3 text-${colorSecundario}-700 hover:text-${colorPrimario}-600 transition-all text-base hover-slide-right`}
      >
        <div class="w-5 h-5 flex-shrink-0">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
          </svg>
        </div>
        <span class="font-medium">{telefono}</span>
      </a>
    )}
    
    {email && (
      <a 
        href={`mailto:${email}`}
        class={`flex items-center justify-center gap-3 text-${colorSecundario}-700 hover:text-${colorPrimario}-600 transition-all text-base hover-slide-right`}
      >
        <div class="w-5 h-5 flex-shrink-0">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
          </svg>
        </div>
        <span class="font-medium break-all">{email}</span>
      </a>
    )}
    
    {sitioWeb && (
      <a 
        href={sitioWeb}
        target="_blank"
        rel="noopener noreferrer"
        class={`flex items-center justify-center gap-3 text-${colorSecundario}-700 hover:text-${colorPrimario}-600 transition-all text-base hover-slide-right`}
      >
        <div class="w-5 h-5 flex-shrink-0">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
          </svg>
        </div>
        <span class="font-medium break-all">{sitioWeb.replace('https://', '').replace('http://', '')}</span>
      </a>
    )}
  </div>

  <!-- Redes -->
  {(linkedin || twitter || facebook || instagram || whatsapp) && (
    <div class={`flex flex-wrap justify-center gap-3 mb-6 pt-6 border-t border-${colorPrimario}-100 fade-in-item`} style="animation-delay: 0.5s">
      {linkedin && (
        <a 
          href={linkedin}
          target="_blank"
          rel="noopener noreferrer"
          class={`w-12 h-12 rounded-full bg-${colorPrimario}-100 flex items-center justify-center text-${colorPrimario}-600 hover:bg-${colorPrimario}-600 hover:text-white transition-all hover-bounce-gentle flex-shrink-0`}
          title="LinkedIn"
        >
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
          </svg>
        </a>
      )}
      
      {whatsapp && (
        <a 
          href={`https://wa.me/${whatsapp.replace(/\D/g, '')}`}
          target="_blank"
          rel="noopener noreferrer"
          class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-green-600 hover:bg-green-600 hover:text-white transition-all hover-bounce-gentle flex-shrink-0"
          title="WhatsApp"
        >
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
        </a>
      )}
    </div>
  )}

  <!-- Botones -->
  <div class="flex gap-3 fade-in-item" style="animation-delay: 0.6s">
    <a 
      href={vcardDownloadUrl}
      download={downloadFileName}
      class={`flex-1 bg-${colorPrimario}-600 text-white px-6 py-4 rounded-xl font-semibold hover:bg-${colorPrimario}-700 transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl hover:-translate-y-0.5 text-base`}
    >
      <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
      </svg>
      <span class="hidden sm:inline">Guardar contacto</span>
      <span class="sm:hidden">Guardar</span>
    </a>
    
    <button 
      id="share-btn"
      class={`bg-${colorSecundario}-100 text-${colorSecundario}-700 px-6 py-4 rounded-xl font-semibold hover:bg-${colorSecundario}-200 transition-all flex items-center justify-center gap-2 flex-shrink-0 hover:scale-105`}
      title="Compartir"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
      </svg>
    </button>
  </div>
</div>

<style>
  /* ========================================
     SKELETON LOADING
     ======================================== */
  .skeleton-card {
    animation: fade-in 0.3s ease-out;
  }

  @keyframes shimmer {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  .skeleton-shimmer {
    background: linear-gradient(
      90deg,
      #f0f0f0 0%,
      #e0e0e0 20%,
      #f0f0f0 40%,
      #f0f0f0 100%
    );
    background-size: 1000px 100%;
    animation: shimmer 2s infinite linear;
  }

  /* ========================================
     ENTRANCE ANIMATIONS
     ======================================== */
  @keyframes card-entrance {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.95);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .card-entrance {
    animation: card-entrance 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes scale-in {
    0% {
      opacity: 0;
      transform: scale(0.7) rotate(-5deg);
    }
    100% {
      opacity: 1;
      transform: scale(1) rotate(0deg);
    }
  }

  .scale-in-item {
    animation: scale-in 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    opacity: 0;
  }

  @keyframes fade-in-up {
    0% {
      opacity: 0;
      transform: translateY(15px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fade-in-item {
    animation: fade-in-up 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    opacity: 0;
  }

  /* ========================================
     HOVER EFFECTS
     ======================================== */
  .hover-lift {
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .hover-lift:hover {
    transform: translateY(-5px) scale(1.05);
  }

  .hover-rotate {
    transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .hover-rotate:hover {
    transform: rotate(360deg);
  }

  .hover-bounce {
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  .hover-bounce:hover {
    animation: bounce-gentle 0.5s ease-in-out;
  }

  @keyframes bounce-gentle {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .hover-bounce-gentle {
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .hover-bounce-gentle:hover {
    transform: scale(1.1) translateY(-2px);
  }

  .hover-slide-right {
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .hover-slide-right:hover {
    transform: translateX(5px);
  }

  /* ========================================
     UTILITIES
     ======================================== */
  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>

<script is:inline>
  // Mostrar tarjeta real despu√©s del skeleton
  setTimeout(function() {
    const skeleton = document.getElementById('skeleton');
    const card = document.getElementById('card');
    
    if (skeleton && card) {
      skeleton.style.display = 'none';
      card.classList.remove('hidden');
    }
  }, 800);

  // Bot√≥n compartir
  document.addEventListener('DOMContentLoaded', function() {
    const shareBtn = document.getElementById('share-btn');
    const nombre = document.querySelector('h2')?.textContent || 'Tarjeta de contacto';
    
    if (shareBtn) {
      shareBtn.addEventListener('click', async function() {
        if (navigator.share) {
          try {
            await navigator.share({
              title: nombre,
              text: 'Mira mi tarjeta de contacto',
              url: window.location.href
            });
          } catch (err) {
            if (err.name !== 'AbortError') {
              copiarLink();
            }
          }
        } else {
          copiarLink();
        }
      });
    }
    
    function copiarLink() {
      navigator.clipboard.writeText(window.location.href).then(function() {
        // Feedback visual
        const btn = document.getElementById('share-btn');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
        setTimeout(function() {
          btn.innerHTML = originalHTML;
        }, 2000);
      }).catch(function() {
        prompt('Copia este link:', window.location.href);
      });
    }
  });
</script>